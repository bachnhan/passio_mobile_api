@model IEnumerable<StoreViewModel>

@{
    ViewBag.Title = "Báo cáo doanh thu sản phẩm";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<!-- PAGE CONTENT -->
<div class="card">
    <div class="card-header" style="padding-bottom:5px">
        <div class="row">
            <div class="col-md-4">
                <h3>Báo cáo sản phẩm</h3>
                <h5 data-role="small-date" id="dateRange"></h5>
            </div>
            <div class="col-md-8">
                <div style="text-align: right;">
                    <!-- ALL STORE -->
                    <button type="submit" id="exportAllStore" class="btn btn-primary btn-sm">
                        <i class="fa fa-download"></i>
                        Xuất ra file Excel
                    </button><!-- ALL STORE END -->
                    <!-- ONE SOTRE -->
                    <button type="submit" id="exportOneStore" class="btn btn-primary btn-sm">
                        <i class="fa fa-download"></i>
                        Xuất ra file Excel
                    </button><!-- ONE SOTRE END -->
                </div><!-- EXPORT TO EXCEL END -->
            </div>
        </div>
        <hr />
        <div class="row" style="margin-top: 19px;">
            <div class="col-md-12">
                <form id="form-create-session" class="form-inline">
                    
                    <div class="input-group myGroupChooseWeek" style="display: inline-flex;">
                        <label class="right-icon">Cửa hàng: &nbsp;</label>


                        <div class="styled-select blue semi-square" style="width: 150px;">
                            <select id="groupStoreId">
                                <option value="0">Tất cả cửa hàng</option>
                                @foreach (var item in Model)
                                {
                                    <option value="@item.ID">@item.Name</option>
                                }
                            </select>
                        </div>


                    </div>
                    
                    @*<div class="input-group myGroupChooseWeek" style="margin-right: 30px">
                        <label class="right-icon">Cửa hàng: &nbsp;</label>
                        <select id="groupStoreId">
                            <option value="0">Tất cả cửa hàng</option>
                            @foreach (var item in Model)
                            {
                                <option value="@item.ID">@item.Name</option>
                            }
                        </select>

                    </div>*@
                    <div class="input-group myGroupChooseWeek" style="margin-left: 15px">
                        <span> Từ &nbsp;</span>
                        
                        <select id="startHour" style="border-radius: 3px; border: solid 1px #a29fd7;">
                            <option value="-1"></option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                        </select>
                        <span> &nbsp;giờ&nbsp;</span>
                        <span> - &nbsp;</span>
                        <select id="endHour" style="border-radius: 3px; border: solid 1px #a29fd7;">
                            <option value="-1"></option>
                            <option value="0">0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                        </select>
                        <span>&nbsp; giờ</span>
                    </div>
                    <div class="input-group pull-right" style="padding-top:10px">
                        <!-- Daterange picker -->
                        @*<div class="dateTime">
                            <div id="reportrange" class="fg-line m-t-5">
                                <input id="date-string" readonly class="form-control width230 text-center">
                                <a class="myCelenderA"><i class="fa fa-calendar"></i></a>
                            </div>
                        </div>*@
                            @*<div class="fg-line m-t-5">
                                    <div id="reportrange" class="btn-datetime form-control formIndexHourReport">
                                        <input type="text" id="date-string" readonly="" hidden>
                                        <i class="fa fa-calendar"></i>
                                        <span></span> <b class="caret"></b>
                                    </div>
                                </div>*@
                        
                        @*<div class="input-group-btn FindButtonDateTime">
                            <a class="btn btn-primary btn-sm FindDateTime" id="btnSearch" style="margin-top: -5px;">
                                <i class="left-icon fa fa-search"></i>  Tìm
                            </a>
                        </div>*@


                        <div class="dateTime width230 pull-right">
                            <div class="fg-line m-t-5">
                                <div id="reportrange">
                                    <input id="date-string" readonly class="form-control text-center">
                                    <a class="myCelenderA" id=""><i class="fa fa-calendar"></i></a>
                                </div>
                            </div>
                        </div>

                        <div class="input-group-btn FindButtonDateTime">
                            <a class="btn btn-primary btn-sm FindDateTime" id="btnSearch" style="margin-top: -5px;">
                                <i class="left-icon fa fa-search"></i>  Tìm
                            </a>
                        </div>
                    </div>
                    @*<div class="input-group">
                            <div class="date-picker">
                                <input type="text" id="date-string" readonly="">
                                <a id="reportrange"><i class="fa fa-calendar"></i></a>
                            </div><!-- /input-group -->

                            <div class="input-group-btn">
                                <a class="btn btn-success btn-sm" id="btnSearch">
                                    <i class="left-icon fa fa-search"></i>Tìm
                                </a>
                            </div>
                        </div>*@
                    <input type="hidden" id="sTime" />
                    <input type="hidden" id="eTime" />
                    <input type="hidden" id="sHour" />
                    <input type="hidden" id="eHour" />
                </form>
            </div>
        </div>
    </div>

    <div class="card-padding">
        <div id="container" style="width:100%; height:auto"></div><!-- MAIN CHART END -->
        <div id="groupCategoryReport">
            <table id="groupCategoryReportDatatable" class="table table-striped table-bordered table-hover" style="width: 100% !important">
                <thead style="white-space: nowrap; text-overflow: ellipsis;">
                    <tr>
                        <th>
                            <label class="">Tên sản phẩm</label>
                        </th>
                        <th>
                            <label class="">Ngành hàng</label>
                        </th>
                        <th>
                            <label class="">Số lượng</label>
                        </th>
                        <th>
                            <label class="">Tổng tiền</label>
                        </th>
                        <th>
                            <label class="">So sánh</label>
                        </th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>


    <div class="modal fade" tabindex="-1" id="store-comparison-modal" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="width: 1314px; margin-left: -198px;" ;
                 margin-left -152px;">
                <!-- MODAL HEADER -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title text-center"> abc</h4>
                </div><!-- MODAL HEADER END -->
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="row">
                        <!-- COMPARISON CHART -->
                        <div class="col-md-9">
                            <div id="comparison" style="width: 885px; height: auto; margin: 0 auto"></div>
                        </div><!-- COMPARISON CHART -->
                        <!-- FILTER OPTION FOR COMPARISON CHART -->
                        <div class="col-md-3">
                            <!-- STORE LIST CHECK BOX -->
                            <div id="filter" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div class="row"></div>
                            </div><!-- STORE LIST CHECK BOX END -->
                            <!-- OPTION BUTTON -->
                            <div id="filter-option" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="margin-top: 10px">
                                <!-- SELECT ALL STORE -->
                                <button class="btn btn-primary btn-sm" id="filter-select-all">Chọn tất cả</button><!-- SELECT ALL STORE END -->
                                <!-- UNSELECT ALL STORE -->
                                <button class="btn btn-success btn-sm" id="filter-unselect-all">Hủy chọn tất cả</button><!-- UNSELECT ALL STORE END -->
                            </div><!-- OPTION BUTTON END -->
                        </div><!-- FILTER OPTION FOR COMPARISON CHART END -->

                    </div>
                </div><!-- ./Modal body -->
            </div>
        </div>
    </div>
</div>








@*<div class="page-content">
        <!-- PAGE HEADER -->
        <div class="page-header">
            <div class="row">
                <div class="col-md-4">
                    <h1>Báo cáo sản phẩm</h1>
                    <h1><small data-role="small-date" id="dateRange"></small><small data-role="small-date" id="timeRange"></small></h1>
                </div>
                <div class="col-md-8 text-right">
                    <form id="form-create-session" class="form-inline">
                        <div class="input-group" style="margin-right: 5px">
                            <label class="right-icon">Cửa hàng:</label>
                            <select id="groupStoreId">
                                <option value="0">Tất cả cửa hàng</option>
                                @foreach (var item in Model)
                                {
                                    <option value="@item.ID">@item.ShortName</option>
                                }
                            </select>

                        </div>
                        <div class="input-group" style="margin-right: 5px">
                            <span> Từ </span>
                            <select id="startHour">
                                <option value="-1"></option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                                <option value="24">24</option>
                            </select>
                            <span>giờ</span>
                            <span> tới </span>
                            <select id="endHour">
                                <option value="-1"></option>
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                                <option value="11">11</option>
                                <option value="12">12</option>
                                <option value="13">13</option>
                                <option value="14">14</option>
                                <option value="15">15</option>
                                <option value="16">16</option>
                                <option value="17">17</option>
                                <option value="18">18</option>
                                <option value="19">19</option>
                                <option value="20">20</option>
                                <option value="21">21</option>
                                <option value="22">22</option>
                                <option value="23">23</option>
                                <option value="24">24</option>
                            </select>
                            <span>giờ</span>
                        </div>
                        <div class="input-group">
                            <div class="date-picker">
                                <input type="text" id="date-string" readonly="">
                                <a id="reportrange"><i class="fa fa-calendar"></i></a>
                            </div><!-- /input-group -->

                            <div class="input-group-btn">
                                <a class="btn btn-success btn-sm" id="btnSearch">
                                    <i class="left-icon fa fa-search"></i>Tìm
                                </a>
                            </div>
                        </div>
                        <input type="hidden" id="sTime" />
                        <input type="hidden" id="eTime" />
                        <input type="hidden" id="sHour" />
                        <input type="hidden" id="eHour" />
                    </form>
                </div>
            </div>
        </div><!-- PAGE HEADER END -->
        <!-- MAIN CHART -->
        <div id="container" style="width:100%;height:auto"></div><!-- MAIN CHART END -->
        <!-- EXPORT TO EXCEL -->
        <div style="margin-right:15px;">
            <!-- ALL STORE -->
            <button type="submit" id="exportAllStore" class="btn btn-success btn-sm">
                <i class="fa fa-download"></i>
                Xuất ra file Excel
            </button><!-- ALL STORE END -->
            <!-- ONE SOTRE -->
            <button type="submit" id="exportOneStore" class="btn btn-success btn-sm">
                <i class="fa fa-download"></i>
                Xuất ra file Excel
            </button><!-- ONE SOTRE END -->
        </div><!-- EXPORT TO EXCEL END -->
        <!-- CATEGORIES TABLE -->
        <div id="groupCategoryReport">
            <table id="groupCategoryReportDatatable" class="table table-striped table-bordered table-hover" style="width: 100% !important">
                <thead style="white-space: nowrap; text-overflow: ellipsis;">
                    <tr>
                        <th>
                            <label class="">Tên sản phẩm</label>
                        </th>
                        <th>
                            <label class="">Ngành hàng</label>
                        </th>
                        <th>
                            <label class="">Số lượng</label>
                        </th>
                        <th>
                            <label class="">Tổng tiền</label>
                        </th>
                        <th>
                            <label class="">So sánh</label>
                        </th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div><!-- CATEGORIES TABLE END -->
    </div><!-- PAGE CONTENT END -->
    <!-- MODAL FOR COMPARISON -->
    <div class="modal fade" tabindex="-1" id="store-comparison-modal" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content" style="width: 1220px;
        margin-left: -152px;">
                <!-- MODAL HEADER -->
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title text-center"> abc</h4>
                </div><!-- MODAL HEADER END -->
                <!-- Modal body -->
                <div class="modal-body">
                    <div class="row">
                        <!-- COMPARISON CHART -->
                        <div class="col-md-9">
                            <div id="comparison" style="width: 885px; height: auto; margin: 0 auto"></div>
                        </div><!-- COMPARISON CHART -->
                        <!-- FILTER OPTION FOR COMPARISON CHART -->
                        <div class="col-md-3">
                            <!-- STORE LIST CHECK BOX -->
                            <div id="filter" class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                                <div class="row"></div>
                            </div><!-- STORE LIST CHECK BOX END -->
                            <!-- OPTION BUTTON -->
                            <div id="filter-option" class="col-lg-12 col-md-12 col-sm-12 col-xs-12" style="text-align: center;margin-top: 10px">
                                <!-- SELECT ALL STORE -->
                                <button class="btn btn-success btn-sm" id="filter-select-all">Select all</button><!-- SELECT ALL STORE END -->
                                <!-- UNSELECT ALL STORE -->
                                <button class="btn btn-success btn-sm" id="filter-unselect-all">Unselect all</button><!-- UNSELECT ALL STORE END -->
                            </div><!-- OPTION BUTTON END -->
                        </div><!-- FILTER OPTION FOR COMPARISON CHART END -->

                    </div>
                </div><!-- ./Modal body -->
            </div>
        </div>
    </div>*@<!-- MODAL FOR COMPARISON END -->

<form class="hidden" id="formProductCategoryReportAllExcel" action="@Url.Action("ExportProductCategoryAllStoreToExcel","SystemReport")">
    <input id="startTimeAll" name="startTime" />
    <input id="endTimeAll" name="endTime" />
</form>

<form class="hidden" id="formProductCategoryReportOneExcel" action="@Url.Action("ExportProductCategoryOneStoreToExcel","SystemReport")">
    <input id="startTimeOne" name="startTime" />
    <input id="endTimeOne" name="endTime" />
    <input name="storeIdReport" />
</form>

<script>

    $(document).ready(function () {
        // Daterange picker
        function cb(start, end, label) {
            var startTime = start.format("DD/MM/YYYY"),
                endTime = end.format("DD/MM/YYYY"),
                dateString = "(" + startTime + (startTime == endTime ? "" : " - " + endTime) + ")";

            if (label != "Tùy chọn") {
                $('#date-string').val(label);
            } else {
                $("#date-string").val(dateString);
            }

            $("#sTime").val(startTime);
            $("#eTime").val(endTime);
            $("#dateRange").html(dateString);
        }
        cb(moment(), moment(), "Hôm nay");

        $('#reportrange').daterangepicker({
            "opens": "left",
            "maxDate": moment(),
            locale: {
                format: 'DD/MM/YYYY'
            },
            ranges: {
                'Hôm nay': [moment(), moment()],
                'Hôm qua': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
                'Tuần này': [moment().startOf('isoweek'), moment().endOf('isoweek')],
                'Tuần trước': [moment().subtract(1, 'week').startOf('isoweek'), moment().subtract(1, 'week').endOf('isoweek')],
                'Tháng này': [moment().startOf('month'), moment().endOf('month')],
                'Tháng trước': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
            }
        }, cb);

        $("#startHour").change(function () {
            var hour = $("#startHour").val();
            if (hour == -1) {
                $("#sHour").val("");
            } else {
                $("#sHour").val(hour);
            }
        });

        $("#endHour").change(function () {
            var hour = $("#endHour").val();
            if (hour == -1) {
                $("#eHour").val("");
            } else {
                $("#eHour").val(hour);
            }
        });

        productCategoryReportAllStore();

        // Comparisondata array for saving data from Comparison chart, easy to using againt if it needed.
        var Comparisondata = [];

        $('#filter').on('change', function () {
            filterStoreList = [];
            filterFinalAmount = [];

            $('.store-name-filter:checked').each(function () {
                filterStoreList.push($(this).val());
                filterFinalAmount.push($(this).data('finalamount'));
            });

            Comparisondata.StoreName = filterStoreList;
            Comparisondata.FinalAmount = filterFinalAmount;

            comparisonchart(Comparisondata);
        });

        // seleck and unseleck all click event
        $('#filter-option').on('click', '#filter-select-all', function () {
            $('.store-name-filter').prop('checked', "checked");
            $('#filter').trigger('change');
        });

        $('#filter-option').on('click', '#filter-unselect-all', function () {
            $('.store-name-filter').removeAttr('checked');
            $('#filter').trigger('change');
        })

        $(document).on('click', '.btnComparison', function () {
            cateName = $(this).data('catname');
            storeID = $(this).data('storeid');
            $('#filter .row').empty();

            $.ajax({
                url: '@Url.Action("LoadProductCategoryComparisonReport")',
                type: 'GET',
                data: { startTime: $('#sTime').val(), endTime: $('#eTime').val(), cateName: storeID },
                success: function (rs) {

                    Comparisondata = rs.dataChart;
                    comparisonchart(Comparisondata);

                    var checkbox = function (index, val) {
                        return $('<div/>', {
                            'class': 'col-md-6',
                            'html': [
                                $('<input/>', {
                                    'type': 'checkbox',
                                    'value': val,
                                    'class': 'nice-check nice-check-sm store-name-filter',
                                    'id': 'filter-' + index,
                                    'checked': 'checked'
                                }),
                                $('<label/>', {
                                    'type': 'checkbox',
                                    'for': 'filter-' + index,
                                    'html': val
                                }),
                            ]
                        });
                    }

                    $.each(Comparisondata.StoreName, function (index, value) {
                        $('#filter .row').append(checkbox(index, value));
                    });

                    var listCheckbox = $('.store-name-filter');

                    $.each(Comparisondata.FinalAmount, function (index, value) {
                        var check = listCheckbox.eq(index); // use function eq to list all store
                        check.attr('data-finalamount', value);
                    });

                    $('.modal-title').html(cateName);
                    $('#store-comparison-modal').modal('show');
                }
            });


        });

    });

    $('#btnSearch').on('click', function () {
        var sHour = $("#sHour").val();
        var eHour = $("#eHour").val();

        if ($("#eTime").val().length > 16 || $("#sTime").val().length > 16) {
            ShowMessage('Vui lòng nhập thời gian đúng định dạng', 3);
            return;
        }
        if ((sHour == '' && eHour != '') || (sHour != '' && eHour == '')) {
            ShowMessage('Vui lòng nhập đầy đủ thời gian bắt đầu và kết thúc', 3);
            return;
        }


        if ($('#groupStoreId').val() == 0) {
            productCategoryReportAllStore();
        }
        else {
            productCategoryReportOneStore();
        }
        //console.log($('#groupStoreId').val());
    });

    var productCategoryReportOneStore = function () {
        //console.log($('#groupStoreId').val());
        $('#exportAllStore').hide();
        $('#exportOneStore').show();
        var sHour = $("#sHour").val();
        var eHour = $("#eHour").val();

        $.ajax({
            type: 'GET',
            url: '@Url.Action("ProductCategoryReportOneStore")',
            data: { 'startTime': $('#sTime').val(), 'endTime': $('#eTime').val(), 'storeIdReport': $('#groupStoreId').val(), "startHour": sHour, "endHour": eHour },
            //dataType: 'html',
            success: function (result) {
                var timeRange = '';
                if (sHour != "" && eHour != "") {
                    timeRange = "(" + sHour + "h" + " - " + eHour + "h" + ")";
                }
                $("#timeRange").html(timeRange);
                initProductReportDatatable(result.dataTable, false);
                // Set up main chart
                var dataChart = result.dataChart;
                if (dataChart) {
                    $('#container').show();
                    setUpMainChart(dataChart);
                } else {
                    $('#container').hide();
                }
            }
        });
    };



    var productCategoryReportAllStore = function () {
        $('#exportAllStore').show();
        $('#exportOneStore').hide();
        var sHour = $("#sHour").val();
        var eHour = $("#eHour").val();

        $.ajax({
            type: 'GET',
            url: '@Url.Action("ProductCategoryReportAllStore")',
            data: { 'startTime': $('#sTime').val(), 'endTime': $('#eTime').val(), "startHour": sHour, "endHour": eHour },
            //dataType: 'html',
            success: function (rs) {
                var timeRange = '';
                if (sHour != "" && eHour != "") {
                    timeRange = "(" + sHour + "h" + " - " + eHour + "h" + ")";
                }
                $("#timeRange").html(timeRange);
                initProductReportDatatable(rs.dataTable, true)

                var dataChart = rs.dataChart;
                if (dataChart) {
                    $('#container').show();
                    setUpMainChart(dataChart);
                } else {
                    $('#container').hide();
                }
            }
        });
    };

    var initProductReportDatatable = function (data, visible) {
        $('#groupCategoryReport').html('<table id="groupCategoryReportDatatable" class="table table-striped table-bordered table-hover" style="width: 100% !important">'
                    + '<thead style="white-space: nowrap; text-overflow: ellipsis;"><tr><th><label class="">Tên sản phẩm</label></th>'
                    + '<th> <label class="">Ngành hàng</label></th><th><label class="">Số lượng</label></th>'
                    + '<th><label class="">Tổng tiền</label></th>'
                    + '<th><label class="">So sánh</label></th>'
                    + '</tr></thead><tbody></tbody></table>');

        $("#groupCategoryReportDatatable").dataTable({
            "bFilter": false,
            "bSort": false,
            "bRetrieve": true,
            "bScrollCollapse": true,
            "data": data,
            "iDisplayLength": 25,
            "aLengthMenu": [25, 50, 150],
            "oLanguage": {
                "sSearch": "Tìm kiếm:",
                "sZeroRecords": "Không có dữ liệu phù hợp",
                "sInfo": "Hiển thị từ _START_ đến _END_ trên tổng số _TOTAL_ dòng",
                "sEmptyTable": "Không có dữ liệu",
                "sInfoFiltered": " - lọc ra từ _MAX_ dòng",
                "sLengthMenu": "Hiển thị _MENU_ dòng",
                "sProcessing": "Đang xử lý...",
                "oPaginate": {
                    "sNext": "<i class='fa fa-chevron-right'></i>",
                    "sPrevious": "<i class='fa fa-chevron-left'></i>"
                }
            },

            "aoColumnDefs": [
                {
                    "visible": false, "targets": 1
                },
                {
                    "aTargets": [2, 3],
                    "sClass": "text-center"
                },
                {
                    "aTargets": [4],
                    "mRender": function (data, type, o) {
                        return '<a data-catname="' + o[0] + '" data-storeid="' + o[4] + '" class="btn btn-sm btn-info btnComparison"><span class="fa fa-tasks"></span></a>';
                    },
                    'visible': visible,
                }
            ],
            "bAutoWidth": true,
            "order": [[1, 'asc']],
            "drawCallback": function (settings) {
                var api = this.api();
                var rows = api.rows({ page: 'current' }).nodes();
                var last = null;

                api.column(1, { page: 'current' }).data().each(function (group, i) {
                    if (last !== group) {
                        $(rows).eq(i).before(
                            '<tr><td class="bg-warning" colspan="5">' + group + '</td></tr>'
                        );

                        last = group;
                    }
                });
            },
        }).fnSetFilteringDelay(delaySearch);
    };

    // Export to excel. All store.
    $(document).on('click', '#exportAllStore', function () {
        $('#startTimeAll').val($('#sTime').val());
        $('#endTimeAll').val($('#eTime').val());
        $('#formProductCategoryReportAllExcel').submit();
    });
    // Export to excel. One store.
    $(document).on('click', '#exportOneStore', function () {
        $('#startTimeOne').val($('#sTime').val());
        $('#endTimeOne').val($('#eTime').val());
        $('input[name=storeIdReport]').val($('#groupStoreId').val());
        $('#formProductCategoryReportOneExcel').submit();
    });

    function comparisonchart(data) {
        //console.log(data);
        $('#comparison').highcharts({
            chart: {
                type: 'column'
            },
            title: {
                text: ''
            },
            xAxis: {
                categories: data.StoreName,
                crosshair: true
            },
            yAxis: {
                min: 0,
            },

            tooltip: {
                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                    '<td style="padding:0"><b>{point.y} VNĐ</b></td></tr>',
                footerFormat: '</table>',
                shared: true,
                useHTML: true
            },
            plotOptions: {
                column: {
                    pointPadding: 0.2,
                    borderWidth: 0
                }
            },
            series: [{
                name: 'Tổng tiền',
                data: data.FinalAmount
            }]
        });
    }

    function setUpMainChart(data) {
        var series = [];
        var listProductName = data.listProductName;
        var listPercentQuantity = data.listPercentQuantity;

        for (var i = 0; i < listProductName.length; i++) {
            var temp = {
                'name': listProductName[i],
                'y': listPercentQuantity[i]
            };

            series.push(temp);
        }

        $('#container').highcharts({
            chart: {
                plotBackgroundColor: null,
                plotBorderWidth: null,
                plotShadow: false,
                type: 'pie'
            },
            title: {
                text: 'Số lượng sản phẩm'
            },
            tooltip: {
                valueDecimals: 1,
                valueSuffix: '',
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>: {point.y:0.1f} %',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    }
                }
            },
            series: [{
                name: 'Số lượng',
                colorByPoint: true,
                data: series,
            }]
        });
    };
</script>
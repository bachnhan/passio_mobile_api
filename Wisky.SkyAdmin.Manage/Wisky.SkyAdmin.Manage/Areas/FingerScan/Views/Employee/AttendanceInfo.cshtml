@using HmsService.Models;
@{
    var current = CurrentStatusEnum.Current.DisplayName();
    var past = CurrentStatusEnum.Past.DisplayName();
    var Future = CurrentStatusEnum.Future.DisplayName();

    var comelate = StatusAttendance.ComeLate.DisplayName();
    var Bothviolate = StatusAttendance.Bothviolate.DisplayName();
    var Miss = StatusAttendance.Miss.DisplayName();
    var OnTime = StatusAttendance.OnTime.DisplayName();
    var ReturnEarly = StatusAttendance.ReturnEarly.DisplayName();
    var empId = ViewBag.empId;
    var empName = ViewBag.empName;
}
@{
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<style>
    .myHr {
        border-bottom: 1px solid lightgray;
        margin-top: 0px !important;
    }

    .mtab_content {
        display: none;
    }
</style>
<link href="~/Content/calendarResource/calendar.css" rel="stylesheet" />
<div class="card">
    <div>
        <div class="card-header">
            <div class="box-header p-b-0">
                <div class="row">
                    <div class="col-md-6">
                        <h3 id="title-shift-model">Thông tin làm việc của @empName</h3>
                    </div>
                </div>
            </div>
            <hr />
        </div>
        <div id="mtabs">
            <ul id="tabList" class="nav nav-tabs ui-sortable-handle" style="margin-left:25px">
                <li style="margin-top:10px; background-color:#f9f9f9" class="waves-effect active"><a data-toggle="tab" href="#shiftTable">Tổng hợp lịch làm việc </a></li>
                <li style="margin-top:10px; background-color:#f9f9f9" class="waves-effect"><a data-toggle="tab" href="#checkFingerTable">Lịch Sử Điểm Danh</a></li>
                <li style="margin-top:10px; background-color:#f9f9f9" class="waves-effect"><a data-toggle="tab" href="#checkFingerCalendar">Chi tiết công việc trong tuần</a></li>
            </ul>
        </div>
        <div id="mtabs_content_container">
            <div id="shiftTable" class="mtab_content" style="display: block;">
                <div class="card-padding">
                    <div class="row" style="margin-top:-10px;margin-bottom:10px">
                        <div class="col-md-12 p-0">
                            <div class="col-md-2">
                                <button type="button" class="btn btn-primary" data-toggle="collapse" data-target="#btnBoLoc" style="height:37px;margin-top:10px">Bộ lọc</button>
                            </div>
                            <div class="col-md-6 pull-right p-0" style="margin-top:10px">
                                <div class="pull-right text-right myDatetimePicker">
                                    <div class="input-group">
                                        <div class="dateTime width230 pull-right">
                                            <div class="fg-line m-t-5">
                                                <div id="time-range-picker">
                                                    <input id="date-string" readonly class="form-control text-center">
                                                    <a class="myCelenderA" id=""><i class="fa fa-calendar"></i></a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="input-group-btn FindButtonDateTime">
                                            <a class="btn btn-primary btn-sm FindDateTime" id="btnSearch" style="margin-top: -5px;">
                                                <i class="left-icon fa fa-search"></i>  Tìm
                                            </a>
                                        </div>
                                    </div>
                                    <input type="text" id="sTime" name="startTime" placeholder="Chọn giờ bắt đầu" hidden="hidden" />
                                    <input type="text" id="eTime" name="endTime" placeholder="Chọn giờ kết thúc" hidden="hidden" />
                                </div>
                                <div  class="pull-right text-right">
                                    <button id="exportOneShift" class="width230 btn btn-primary btn-sm" onclick="exportExcellOneShift()">
                                        <i class="fa fa-download"></i>
                                        Xuất ra file Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="collapse" id="btnBoLoc">
                        <div class="group-radio-buttons myGroup-radio-buttons " style="padding-bottom: 10px">
                            <div class="col-md-12" style="">
                                <h4 style="margin-bottom:5px;font-weight:bold;">Tình trạng</h4>
                            </div>
                            <div class="row small-margin">
                                <div class="col-md-4" style="padding-left:100px">
                                    <input type="radio" name="searchBy" value="-1" class="nice-check" checked id="byAll" />
                                    <label for="byAll"><span>Tất cả</span></label>
                                </div>
                                <div class="col-md-4" style="padding-left:100px">
                                    <input type="radio" name="searchBy" value="@((int)StatusAttendance.ComeLate)" class="nice-check" id="byLate" />
                                    <label for="byLate"><span>Đi trễ</span></label>
                                </div>
                                <div class="col-md-4" style="padding-left:100px">
                                    <input type="radio" name="searchBy" value="@((int)StatusAttendance.ReturnEarly)" class="nice-check" id="byEarly" />
                                    <label for="byEarly"><span>Về sớm</span></label>
                                </div>
                                <div class="col-md-4" style="padding-left:100px">
                                    <input type="radio" name="searchBy" value="@((int)StatusAttendance.OnTime)" class="nice-check" id="byOnTime" />
                                    <label for="byOnTime"><span>Đúng giờ</span></label>
                                </div>
                                <div class="col-md-4" style="padding-left:100px">
                                    <input type="radio" name="searchBy" value="@((int)StatusAttendance.Miss)" class="nice-check" id="byMiss" />
                                    <label for="byMiss"><span>Vắng</span></label>
                                </div>
                                <div class="col-md-4" style="padding-left:100px">
                                    <input type="radio" name="searchBy" value="@((int)StatusAttendance.Bothviolate)" class="nice-check" id="byViolate" />
                                    <label for="byViolate"><span>Đi Trễ Về Sớm</span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="tab-content">
                            <div class="tab-pane active">
                                <!-- Datatable -->
                                <div class="col-md-12">

                                    <table id="shiftDatatable" class="table table-hover dataTable table-bordered nowrap" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th><label>STT</label></th>
                                                <th><label>Ngày làm việc</label></th>
                                                <th><label>Giờ bắt đầu</label></th>
                                                <th><label>Giờ kết thúc</label></th>
                                                <th><label>Tổng TG</label></th>
                                                <th><label>Tình Trạng</label></th>
                                                <th><label>Thời gian</label></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="checkFingerTable" class="mtab_content">
                <div class="card-padding">
                    <div class="row" style="margin-top:-10px;margin-bottom:10px">
                        <div class="col-md-12 p-0">
                            <div class="col-md-6 pull-right p-0" style="margin-top:10px">
                                <div class="pull-right text-right myDatetimePicker">
                                    <div class="input-group">
                                        <div class="dateTime width230 pull-right">
                                            <div class="fg-line m-t-5">
                                                <div id="time-range-picker-check">
                                                    <input id="date-string-check" readonly class="form-control text-center">
                                                    <a class="myCelenderA" id=""><i class="fa fa-calendar"></i></a>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="input-group-btn FindButtonDateTime">
                                            <a class="btn btn-primary btn-sm FindDateTime" id="btnSearchCheck" style="margin-top: -5px;">
                                                <i class="left-icon fa fa-search"></i>  Tìm
                                            </a>
                                        </div>
                                    </div>
                                    <input type="text" id="sTimeCheck" name="startTimeCk" placeholder="Chọn giờ bắt đầu" hidden="hidden" />
                                    <input type="text" id="eTimeCheck" name="endTimeCk" placeholder="Chọn giờ kết thúc" hidden="hidden" />
                                </div>
                                <div class="pull-right text-right">
                                    <button id="exportOneShift" class="width230 btn btn-primary btn-sm" onclick="exportExcellOneShiftFinger()">
                                        <i class="fa fa-download"></i>
                                        Xuất ra file Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="tab-content">
                            <div class="tab-pane active" id="allcust">
                                <!-- Datatable -->
                                <div class="col-md-12">

                                    <table id="detail-table" class="table table-hover dataTable table-bordered dt-responsive nowrap" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th><label>STT</label></th>
                                                <th><label>Ngày giờ check</label></th>
                                                <th><label>Máy scan</label></th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="checkFingerCalendar" class="mtab_content">
                <div class="card-header">
                    <div class="row" style="margin-bottom: 10px">
                        <label style="margin-left:20px;"><i class="fa fa-tag" aria-hidden="true"></i> &nbsp;Chú thích:</label> <br> <br>
                        <div class="col-md-2"><label class="label label-default" style="font-size: small; margin-left: 20px; background-color: #5BC0DE;">A</label> : Ca tương lai</div>
                        <div class="col-md-2"><label class="label label-default" style="font-size: small; margin-left: 20px; background-color: #D9534F;">A</label> : Ca vắng</div>
                        <div class="col-md-2"><label class="label label-default" style="font-size: small; margin-left: 20px; background-color: #F0AD4E;">A</label> : Ca vi phạm</div>
                        <div class="col-md-2"><label class="label label-default" style="font-size: small; margin-left: 20px; background-color: #5CB85C;">A</label> : Ca chuẩn</div>                                          
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                        </div>
                        <div class="col-md-6 pull-right p-0" style="margin-top:10px">
                            <div class="pull-right text-right myDatetimePicker">
                                <div class="input-group">
                                    <div class="dateTime width230 pull-right">
                                        <div class="fg-line m-t-5">
                                            <div id="time-range-picker-calendar">
                                                <input id="weeklyDatePicker" class="form-control text-center">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="input-group-btn FindButtonDateTime">
                                        <a class="btn btn-primary btn-sm FindDateTime" id="btnSearchCalendar" style="margin-top: -5px;">
                                            <i class="left-icon fa fa-search"></i>  Tìm
                                        </a>
                                    </div>
                                </div>
                                <input type="text" id="sTimeCa" name="startTimeCalendar" placeholder="Chọn giờ bắt đầu" hidden="hidden" />
                                <input type="text" id="eTimeCa" name="endTimeCalendar" placeholder="Chọn giờ kết thúc" hidden="hidden" />
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-padding">
                    <header class="headings clearfix">
                        <div class="weekdays clearfix" style="padding-left: 10%;">
                            <div class="weekday heading">Monday</div>
                            <div class="weekday heading non-visible">Tuesday</div>
                            <div class="weekday heading non-visible">Wednesday</div>
                            <div class="weekday heading non-visible">Thursday</div>
                            <div class="weekday heading non-visible">Friday</div>
                            <div class="weekend heading non-visible">Saturday</div>
                            <div class="weekend heading">Sunday</div>
                        </div>
                    </header>
                    <div class="navigator clearfix">
                        <div class="col-xs-6 go-left"><a rel="nofollow" rel="noreferrer" href="" id="goLeft"><span class="glyphicon glyphicon-arrow-left"></span></a></div>
                        <div class="col-xs-6 go-right"><a rel="nofollow" rel="noreferrer" href="" id="goRight"><span class="glyphicon glyphicon-arrow-right"></span></a></div>
                    </div>
                    <div class="container-fluid cearfix" id="weekly_calendar">

                        <div class="columns clearfix dragscroll" style="overflow-y: scroll;height: 650px; cursor: grab; cursor : -o-grab; cursor : -moz-grab; cursor : -webkit-grab;">

                            <div class="hour-column clearfix">
                                <div class="hour">
                                    <div class="hours">
                                        <div class="hr">12 Am</div>
                                        <div class="hr">1 Am</div>
                                        <div class="hr">2 Am</div>
                                        <div class="hr">3 Am</div>
                                        <div class="hr">4 Am</div>
                                        <div class="hr">5 Am</div>
                                        <div class="hr">6 Am</div>
                                        <div class="hr">7 Am</div>
                                        <div class="hr">8 Am</div>
                                        <div class="hr">9 Am</div>
                                        <div class="hr">10 Am</div>
                                        <div class="hr">11 Am</div>
                                        <div class="hr">12 Pm</div>
                                        <div class="hr">1 Pm</div>
                                        <div class="hr">2 Pm</div>
                                        <div class="hr">3 Pm</div>
                                        <div class="hr">4 Pm</div>
                                        <div class="hr">5 Pm</div>
                                        <div class="hr">6 Pm</div>
                                        <div class="hr">7 Pm</div>
                                        <div class="hr">8 Pm</div>
                                        <div class="hr">9 Pm</div>
                                        <div class="hr">10 Pm</div>
                                        <div class="hr">11 Pm</div>
                                        <div class="hr">All day</div>
                                    </div>
                                </div>
                            </div>

                            <div class="event-column clearfix">
                                <div class="week-grid clearfix" style="top: 0px">
                                    <div class="hours-grid">
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                        <div class="grid"></div>
                                    </div>
                                </div>
                                <div class="events clearfix">
                                    <div class="event-outer clearfix" id="event-outer clearfix">
                                        <div class="event-cont" id="Monday"></div>
                                        <div class="event-cont" id="Tuesday"></div>
                                        <div class="event-cont non-visible" id="Wednesday"></div>
                                        <div class="event-cont non-visible" id="Thursday"></div>
                                        <div class="event-cont today non-visible" id="Friday"></div>
                                        <div class="event-cont non-visible" id="Saturday"></div>
                                        <div class="event-cont non-visible" id="Sunday"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                </div>
            </div>
        </div>
    </div>
</div>

<!--Model container-->
<input type="hidden" id="EmployeeId" />
<!--Model container-->
<div id="create-modal-container">
    <div class="modal" id="create-edit-timeFrame-modal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="form-horizontal">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="Title_Create_Edit">Thông tin ca</h4>
                    </div>
                    <div class="modal-body col-md-12">
                        <div class="col-md-12 p-0">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Tên nhân viên : </label>
                                    <label class="col-sm-8 control-label" id="NameEmp"></label>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Giờ bắt đầu : </label>
                                    <label class="col-sm-8 control-label" id="HourOfStart"></label>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Giờ Kết thúc : </label>
                                    <label class="col-sm-8 control-label" id="HourOfEnd"></label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Tình trạng ca : </label>
                                    <label class="col-sm-8 control-label" id="Status"></label>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Giờ vào : </label>
                                    <label class="col-sm-8 control-label" id="DateOfStart"></label>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label">Giờ ra : </label>
                                    <label class="col-sm-8 control-label" id="DateOfEnd"></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">Đóng</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts {
<script type="text/javascript" src="https://cdn.rawgit.com/asvd/dragscroll/master/dragscroll.js"></script>
    <script>
        // --- Load datatable
        var flag = true;
        $(document).ready(function () {

            $('#datetimepicker').datetimepicker({
                format: 'DD/MM/YYYY',
                defaultDate: moment(),
            });

            setupDaterangepicker();
            setupDaterangepicker2();
            $('[name=searchBy]').change(function () {
                RefreshTable("#shiftDatatable");
            });
            LoadDataTable();
            $("#mtabs li").click(function() {
                $("#mtabs li").removeClass('active');
                $(this).addClass("active");
                $(".mtab_content").hide();
                var selected_tab = $(this).find("a").attr("href");
                if(selected_tab=="#checkFingerTable")
                {
                    //$('#title-shift-model').text('Thông tin lịch sử điểm danh của ' + ' @empName');
                    if (flag == true) {
                        loadCheckFinger();
                        flag = false;
                    }
                }
                else if (selected_tab == "#checkFingerCalendar")
                {
                    //$('#title-shift-model').text('Thông tin làm việc trong tuần của ' +' @empName');
                }
                else
                {
                    //$('#title-shift-model').text('Thông tin làm việc của ' + ' @empName');
                }
                $(selected_tab).fadeIn();
                return false;
            });

           //calendar
            moment.locale('en', {
                week: { dow: 1 } // Monday is the first day of the week
            });

            //Initialize the datePicker(I have taken format as mm-dd-yyyy, you can     //have your owh)
            $("#weeklyDatePicker").datetimepicker({
                format: 'DD/MM/YYYY'
            });
            $("#weeklyDatePicker").val("Tuần này");
            //Get the value of Start and End of Week
            $('#weeklyDatePicker').on('dp.change', function (e) {
                var value = $("#weeklyDatePicker").val();
                var firstDate = moment(value, "DD/MM/YYYY").day(1).format("DD/MM/YYYY");
                var lastDate = moment(value, "DD/MM/YYYY").day(7).format("DD/MM/YYYY");
                $("#weeklyDatePicker").val(firstDate + " - " + lastDate);
                $("#sTimeCa").val(firstDate);
                $("#eTimeCa").val(lastDate);
            });
            loadCalendar();
        });
        //calendar







        function setupDaterangepicker() {
            cb(moment().startOf('day'), moment(), "Hôm nay");
            $('#time-range-picker').daterangepicker({
                "opens": "left",
                "maxDate": moment(),
                locale: {
                    format: 'DD/MM/YYYY'
                },
                ranges: {
                    'Hôm nay': [moment().startOf('day'), moment().endOf('day')],
                    'Hôm qua': [moment().subtract(1, 'day').startOf('day'), moment().subtract(1, 'day').endOf('day')],
                    'Tháng này': [moment().startOf('month'), moment().endOf('month')],
                    'Tháng trước': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, cb);
        }
        function setupDaterangepicker2() {
            cbcheck(moment().startOf('day'), moment(), "Hôm nay");
            $('#time-range-picker-check').daterangepicker({
                "opens": "left",
                "maxDate": moment(),
                locale: {
                    format: 'DD/MM/YYYY'
                },
                ranges: {
                    'Hôm nay': [moment().startOf('day'), moment().endOf('day')],
                    'Hôm qua': [moment().subtract(1, 'day').startOf('day'), moment().subtract(1, 'day').endOf('day')],
                    'Tháng này': [moment().startOf('month'), moment().endOf('month')],
                    'Tháng trước': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
                }
            }, cbcheck);
        }
        $('#btnSearch').on('click', function () {
                //loadCheckFinger();
                RefreshTable("#shiftDatatable");
        });

        $('#btnSearchCheck').on('click', function () {
            loadCheckFinger();
            //RefreshTable("#shiftDatatable");
        });
        $('#btnSearchCalendar').on('click', function () {
            loadCalendar();

        });

        function LoadDataTable(){
            initShiftDatatable()
        }

        function cb(start, end, label) {
            var startTime = start.format("DD/MM/YYYY"),
                endTime = end.format("DD/MM/YYYY"),
                dateString = "(" + startTime + (startTime == endTime ? "" : " - " + endTime) + ")";

            if (label != "Tùy chọn") {
                $('#date-string').val(label);
            } else {
                $("#date-string").val(dateString);
            }

            $("#sTime").val(startTime);
            $("#eTime").val(endTime);
            $("#date-string").html(dateString);
        }
        function cbcheck(start, end, label) {
            var startTimeCk = start.format("DD/MM/YYYY"),
                endTimeCk = end.format("DD/MM/YYYY"),
                dateString = "(" + startTimeCk + (startTimeCk == endTimeCk ? "" : " - " + endTimeCk) + ")";

            if (label != "Tùy chọn") {
                $('#date-string-check').val(label);
            } else {
                $("#date-string-check").val(dateString);
            }

            $("#sTimeCheck").val(startTimeCk);
            $("#eTimeCheck").val(endTimeCk);
            $("#date-string-check").html(dateString);
        }

        //-------------------Datatable------------------
        //redraw datatable without reload
        function reDrawDatatable(id) {

            $.fn.dataTableExt.oApi.fnStandingRedraw = function (oSettings) {
                if (oSettings.oFeatures.bServerSide === false) {
                    var before = oSettings._iDisplayStart;
                    oSettings.oApi._fnReDraw(oSettings);
                    //iDisplayStart has been reset to zero - so lets change it back
                    oSettings._iDisplayStart = before;
                    oSettings.oApi._fnCalculateEnd(oSettings);
                }
                //draw the 'current' page
                oSettings.oApi._fnDraw(oSettings);
            };
            $(id).dataTable().fnStandingRedraw();
        }

        //user datatable
        function RefreshTable(datatableId) {
            reDrawDatatable(datatableId);
        }

        // Get DataAttendance Datatable
        function initShiftDatatable() {
            $("#shiftDatatable").dataTable({
                "bSearchable": false,
                "bSort": false,
                "bServerSide": true,
                "bRetrieve": true,
                "bScrollCollapse": true,
                "sAjaxSource": "@Url.Action("LoadSessionAttendance", "Employee")",
                "fnServerParams": function (aoData) {
                    aoData.push({ "name": "employeeId", "value": @empId });
                    aoData.push({ "name": "startDate", "value": $('#sTime').val() });
                    aoData.push({ "name": "endDate", "value": $('#eTime').val() });
                    aoData.push({ "name": "status", "value": $('input:radio[name=searchBy]:checked').val() });
                },
                "bProcessing": true,
                "aLengthMenu": [10, 25, 50],
                "bFilter": true,
                "oLanguage": {
                    "sZeroRecords": "Không có dữ liệu phù hợp",
                    "sInfo": "Hiển thị từ _START_ đến _END_ trên tổng số _TOTAL_ dòng",
                    "sEmptyTable": "Không có dữ liệu",
                    "sInfoFiltered": " - lọc ra từ _MAX_ dòng",
                    "sLengthMenu": "Hiển thị _MENU_ dòng",
                    "sProcessing": "Đang xử lý...",
                    "oPaginate": {
                        "sNext": "<i class='fa fa-chevron-right'></i>",
                        "sPrevious": "<i class='fa fa-chevron-left'></i>"
                    }
                },
                "aoColumnDefs": [
                    {
                        "aTargets": [0, 1, 2, 3, 4, 5, 6],
                        "sClass": "text-center",
                        "bSortable": false
                    },
                    {
                        "aTargets": [5],
                        "mRender": function (data, type, row) {
                            var html = "";
                            if (data == '@((int)StatusAttendance.Miss)') {
                                html = "<div class='label label-default'>@(Miss)</div>"
                            }
                            if (data == '@((int)StatusAttendance.Bothviolate)') {
                                html = "<div class='label label-danger'>@(Bothviolate)</div>"
                            }
                            if (data == '@((int)StatusAttendance.ComeLate)') {
                                html = "<div class='label label-warning'>@(comelate)</div>"
                            }
                            if (data == '@((int)StatusAttendance.ReturnEarly)') {
                                html = "<div class='label label-warning'>@(ReturnEarly)</div>"
                            }
                            if (data == '@((int)StatusAttendance.OnTime)') {
                                html = "<div class='label label-success'>@(OnTime)</div>"
                            }
                            return html;
                        }
                    },
                    {
                        "aTargets": [6],
                        "mRender": function (data, type, row) {
                            var html = "";
                            if (data == '@((int)CurrentStatusEnum.Future)') {
                                html = "<div class='label label-primary'>@(Future)</div>"
                            }
                            if (data == '@((int)CurrentStatusEnum.Current)') {
                                html = "<div class='label label-success'>@(current)</div>"
                            }
                            if (data == '@((int)CurrentStatusEnum.Past)') {
                                html = "<div class='label label-danger'>@(past)</div>"
                            }
                            return html;
                        }
                    }
                ],
                "bAutoWidth": false
            }).fnSetFilteringDelay(delaySearch);

        }
        function loadCheckFinger() {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetAllCheckFinger")',
                data: {
                    'startTime':  $('#sTimeCheck').val(),
                    'endTime':  $('#eTimeCheck').val(),
                    'empId': @empId,
                },

                success: function (result) {
                    initFingerCheckDatatable(result);
                }
            });
        }
        function initFingerCheckDatatable(data) {
            $("#detail-table").dataTable().fnDestroy();
            $("#detail-table").dataTable({
                stateSave: true,
                "bFilter": true,
                "bSort": false,
                "data": data,
                "bRetrieve": true,
                "bScrollCollapse": true,
                "bProcessing": true,
                "oLanguage": {
                    "sSearch": "Tìm kiếm:",
                    "sSearchPlaceholder": "Thành phần",
                    "sZeroRecords": "Không có dữ liệu phù hợp",
                    "sInfo": "Hiển thị từ _START_ đến _END_ trên tổng số _TOTAL_ dòng",
                    "sEmptyTable": "Không có dữ liệu",
                    "sInfoFiltered": " - lọc ra từ _MAX_ dòng",
                    "sLengthMenu": "Hiển thị _MENU_ dòng",
                    "sProcessing": "Đang xử lý...",
                    "oPaginate": {
                        "sNext": "<i class='fa fa-chevron-right'></i>",
                        "sPrevious": "<i class='fa fa-chevron-left'></i>"
                    }
                },
                "aoColumnDefs": [
                    {
                        "aTargets": [0, 1, 2],
                        "sClass": "text-center",
                        "bSortable": false,
                    },

                ],
                "bAutoWidth": false,
            });
        }
        // Calendar view/////////////////////////////////////////////////////////

        function loadCalendar() {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("LoadCalendarAttendance2")',
                data: {
                    'empId': @empId,
                    'startTime': $('#sTimeCa').val(),
                    'endTime': $('#eTimeCa').val(),
                },

                success: function (result) {
                    $(".remove").remove();
                    addCalendar(result.rs);
                }
            });
        }

        function addCalendar(data) {


            if (data.length > 0) {
                for (i = 0; i < data.length; ++i) {
                    var div = document.createElement('div');
                    div.className = 'event-cont remove';
                    for (j = 0; j < data[i].timeslot.length; ++j) {
                        var a ="";
                        var b ="";

                        if (data[i].timeslot[j].Late != null) {
                            a = '<label style="margin-left: 5px;" class="label label-danger">Đi trễ</label>'
                        }
                        if (data[i].timeslot[j].LeaveEarly != null) {
                            b = '<label style="margin-left: 5px;" class="label label-primary">Về sớm</label>'
                        }
                        div.innerHTML += '<div onclick="ShowSlotModal(' + data[i].timeslot[j].idAttendance + ')" class="event" data-duration="' + data[i].timeslot[j].duration + '" data-start="' + data[i].timeslot[j].startHour + '" style="background: ' + data[i].timeslot[j].color + '">' + a + b +'</br><p style="padding-top: 10px;">' + data[i].timeslot[j].status + '</p></div>';
                    }
                    document.getElementById(data[i].date).appendChild(div);
                }

            }
            $('.event').each(function () {
                var $this = $(this);
                var h = $this.attr('data-duration');
                var pos = $this.attr('data-start');
                $this.css({
                    'height': h * 60,
                    'top': pos * 60,
                    'width' : "700%",
                });
            });

            $(window).resize(function () {
                if ($(window).width() < '650') {
                    $('.event-column').css('margin-left', "60px");
                } else {
                    $('.event-column').css('margin-left', "0");
                    $('.event-column').css('left', '0')
                }
            });


            if ($(window).width() < '650') {
                $('.event-column').css('margin-left', "60px");
            }

            $("#goRight").click(function (event) {
                event.preventDefault();
                var left = $('.event-column').css('left');
                var leftVal = parseInt(left.replace("px", ""));
                if (leftVal === 0) {
                    $('.event-column').css('left', "-114px");
                } else if (leftVal > '-570') {
                    var newPos = (leftVal - 114);
                    $('.event-column').css({
                        left: newPos + 'px'
                    });
                }
                $("#goLeft").css("opacity", "1");
            });

            $("#goLeft").click(function (event) {
                event.preventDefault();

                var left = $('.event-column').css('left');
                var leftVal = parseInt(left.replace("px", ""));
                if (leftVal === 0) {
                    event.preventDefault();
                } else if (leftVal >= '-684') {
                    var newPos = (leftVal + 114);
                    $('.event-column').css({
                        left: newPos + 'px'
                    });
                }
                $("#goLeft").css("opacity", "1");
            });
        }

        //thong tin của ca
        function ShowSlotModal(data) {
            //$('#create-edit-timeFrame-modal').modal('show');
            if (data != 0) {
               $.ajax({
                type: 'POST',
                url: '@Url.Action("detailsAttendance")',
                data: {
                    Id: data
                },
                success: function (result) {
                    $('#create-edit-timeFrame-modal').modal('show');
                    //$('#NameEmp').val(result.Name);
                    //$('#DateOfStart').val(result.StartTime);
                    //$('#DateOfEnd').val(result.EndTime);
                    //$('#Status').val(result.Status);
                    //$('#HourOfStart').val(result.StartHour);
                    //$('#HourOfEnd').val(result.EndHour);
                    document.getElementById('NameEmp').innerHTML = result.Name;
                    document.getElementById('DateOfStart').innerHTML = result.StartTime;
                    document.getElementById('DateOfEnd').innerHTML = result.EndTime;
                    document.getElementById('Status').innerHTML = result.Status;
                    document.getElementById('HourOfStart').innerHTML = result.StartHour;
                    document.getElementById('HourOfEnd').innerHTML = result.EndHour;

                },
                error: function (error) {
                    ShowAlert("Có lỗi xảy ra, vui lòng thử lại", 1);
                }
               });
            }

        }

        function exportExcellOneShift() {
            window.location.replace("@Url.Action("ExportToExcelReport", "Employee")" + "?employeeId=" + @empId + "&startDate=" + $('#sTime').val() + "&endDate=" + $('#eTime').val() + "&status=" + $('input:radio[name=searchBy]:checked').val());
        }
        function exportExcellOneShiftFinger() {
            window.location.replace("@Url.Action("ExportToExcelReportFinger", "Employee")" + "?employeeId=" + @empId + "&startDate=" + $('#sTimeCheck').val() );
        }

    </script>
}